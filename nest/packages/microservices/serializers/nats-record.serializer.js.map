{"version":3,"file":"nats-record.serializer.js","sourceRoot":"","sources":["nats-record.serializer.ts"],"names":[],"mappings":";;;AAAA,8EAAqE;AACrE,oEAA6D;AAI7D,wDAAmE;AAEnE,IAAI,WAAW,GAAG,EAAS,CAAC;AAE5B,MAAa,oBAAoB;IAK/B;QACE,WAAW,GAAG,IAAA,+BAAW,EAAC,MAAM,EAAE,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE,CAChE,OAAO,CAAC,MAAM,CAAC,CAChB,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,WAAW,CAAC,SAAS,EAAE,CAAC;IAC3C,CAAC;IAED,SAAS,CAAC,MAAwB;QAChC,MAAM,WAAW,GACf,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,IAAI,KAAI,IAAA,uBAAQ,EAAC,MAAM,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,IAAI,YAAY,4BAAU;YACxE,CAAC,CAAE,MAAM,CAAC,IAAmB;YAC7B,CAAC,CAAC,IAAI,mCAAiB,CAAC,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,IAAI,CAAC,CAAC,KAAK,EAAE,CAAC;QAElD,OAAO;YACL,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,iCAAM,MAAM,KAAE,IAAI,EAAE,WAAW,CAAC,IAAI,IAAG;YAClE,OAAO,EAAE,WAAW,CAAC,OAAO;SAC7B,CAAC;IACJ,CAAC;CACF;AAvBD,oDAuBC","sourcesContent":["import { loadPackage } from '@nestjs/common/utils/load-package.util';\nimport { isObject } from '@nestjs/common/utils/shared.utils';\nimport { NatsCodec } from '../external/nats-client.interface';\nimport { ReadPacket } from '../interfaces';\nimport { Serializer } from '../interfaces/serializer.interface';\nimport { NatsRecord, NatsRecordBuilder } from '../record-builders';\n\nlet natsPackage = {} as any;\n\nexport class NatsRecordSerializer\n  implements Serializer<ReadPacket, NatsRecord>\n{\n  private readonly jsonCodec: NatsCodec<unknown>;\n\n  constructor() {\n    natsPackage = loadPackage('nats', NatsRecordSerializer.name, () =>\n      require('nats'),\n    );\n    this.jsonCodec = natsPackage.JSONCodec();\n  }\n\n  serialize(packet: ReadPacket | any): NatsRecord {\n    const natsMessage =\n      packet?.data && isObject(packet.data) && packet.data instanceof NatsRecord\n        ? (packet.data as NatsRecord)\n        : new NatsRecordBuilder(packet?.data).build();\n\n    return {\n      data: this.jsonCodec.encode({ ...packet, data: natsMessage.data }),\n      headers: natsMessage.headers,\n    };\n  }\n}\n"]}