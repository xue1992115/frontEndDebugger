{"version":3,"file":"nats-response-json.deserializer.js","sourceRoot":"","sources":["nats-response-json.deserializer.ts"],"names":[],"mappings":";;;AAAA,8EAAqE;AAGrE,qFAAgF;AAChF,qFAA+E;AAE/E,IAAI,WAAW,GAAG,EAAS,CAAC;AAE5B;;GAEG;AACH,MAAa,4BAA6B,SAAQ,6DAA4B;IAG5E;QACE,KAAK,EAAE,CAAC;QAER,WAAW,GAAG,IAAA,+BAAW,EAAC,MAAM,EAAE,4DAA2B,CAAC,IAAI,EAAE,GAAG,EAAE,CACvE,OAAO,CAAC,MAAM,CAAC,CAChB,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,WAAW,CAAC,SAAS,EAAE,CAAC;IAC3C,CAAC;IAED,WAAW,CACT,KAAiB,EACjB,OAA6B;QAE7B,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACpD,OAAO,KAAK,CAAC,WAAW,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;IACpD,CAAC;CACF;AAnBD,oEAmBC","sourcesContent":["import { loadPackage } from '@nestjs/common/utils/load-package.util';\nimport { NatsCodec } from '../external/nats-client.interface';\nimport { IncomingResponse } from '../interfaces';\nimport { IncomingResponseDeserializer } from './incoming-response.deserializer';\nimport { NatsRequestJSONDeserializer } from './nats-request-json.deserializer';\n\nlet natsPackage = {} as any;\n\n/**\n * @publicApi\n */\nexport class NatsResponseJSONDeserializer extends IncomingResponseDeserializer {\n  private readonly jsonCodec: NatsCodec<unknown>;\n\n  constructor() {\n    super();\n\n    natsPackage = loadPackage('nats', NatsRequestJSONDeserializer.name, () =>\n      require('nats'),\n    );\n    this.jsonCodec = natsPackage.JSONCodec();\n  }\n\n  deserialize(\n    value: Uint8Array,\n    options?: Record<string, any>,\n  ): IncomingResponse {\n    const decodedRequest = this.jsonCodec.decode(value);\n    return super.deserialize(decodedRequest, options);\n  }\n}\n"]}