{"version":3,"file":"nats-request-json.deserializer.js","sourceRoot":"","sources":["nats-request-json.deserializer.ts"],"names":[],"mappings":";;;AAAA,8EAAqE;AAGrE,mFAA8E;AAE9E,IAAI,WAAW,GAAG,EAAS,CAAC;AAE5B;;GAEG;AACH,MAAa,2BAA4B,SAAQ,2DAA2B;IAG1E;QACE,KAAK,EAAE,CAAC;QAER,WAAW,GAAG,IAAA,+BAAW,EAAC,MAAM,EAAE,2BAA2B,CAAC,IAAI,EAAE,GAAG,EAAE,CACvE,OAAO,CAAC,MAAM,CAAC,CAChB,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,WAAW,CAAC,SAAS,EAAE,CAAC;IAC3C,CAAC;IAED,WAAW,CACT,KAAiB,EACjB,OAA6B;QAE7B,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACpD,OAAO,KAAK,CAAC,WAAW,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;IACpD,CAAC;CACF;AAnBD,kEAmBC","sourcesContent":["import { loadPackage } from '@nestjs/common/utils/load-package.util';\nimport { NatsCodec } from '../external/nats-client.interface';\nimport { IncomingEvent, IncomingRequest } from '../interfaces';\nimport { IncomingRequestDeserializer } from './incoming-request.deserializer';\n\nlet natsPackage = {} as any;\n\n/**\n * @publicApi\n */\nexport class NatsRequestJSONDeserializer extends IncomingRequestDeserializer {\n  private readonly jsonCodec: NatsCodec<unknown>;\n\n  constructor() {\n    super();\n\n    natsPackage = loadPackage('nats', NatsRequestJSONDeserializer.name, () =>\n      require('nats'),\n    );\n    this.jsonCodec = natsPackage.JSONCodec();\n  }\n\n  deserialize(\n    value: Uint8Array,\n    options?: Record<string, any>,\n  ): IncomingRequest | IncomingEvent {\n    const decodedRequest = this.jsonCodec.decode(value);\n    return super.deserialize(decodedRequest, options);\n  }\n}\n"]}