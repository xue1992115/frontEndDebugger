{"version":3,"file":"incoming-request.deserializer.js","sourceRoot":"","sources":["incoming-request.deserializer.ts"],"names":[],"mappings":";;;AAAA,oEAAgE;AAOhE;;GAEG;AACH,MAAa,2BAA2B;IACtC,WAAW,CACT,KAAU,EACV,OAA6B;QAE7B,OAAO,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;IAC3E,CAAC;IAED,UAAU,CAAC,KAAU;QACnB,IAAI,CAAC,KAAK,EAAE;YACV,OAAO,IAAI,CAAC;SACb;QACD,IACE,CAAC,IAAA,0BAAW,EAAE,KAAyB,CAAC,OAAO,CAAC;YAChD,CAAC,IAAA,0BAAW,EAAE,KAAyB,CAAC,IAAI,CAAC,EAC7C;YACA,OAAO,KAAK,CAAC;SACd;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,WAAW,CACT,KAAU,EACV,OAA6B;QAE7B,IAAI,CAAC,OAAO,EAAE;YACZ,OAAO;gBACL,OAAO,EAAE,SAAS;gBAClB,IAAI,EAAE,SAAS;aAChB,CAAC;SACH;QACD,OAAO;YACL,OAAO,EAAE,OAAO,CAAC,OAAO;YACxB,IAAI,EAAE,KAAK;SACZ,CAAC;IACJ,CAAC;CACF;AApCD,kEAoCC","sourcesContent":["import { isUndefined } from '@nestjs/common/utils/shared.utils';\nimport {\n  ConsumerDeserializer,\n  IncomingEvent,\n  IncomingRequest,\n} from '../interfaces';\n\n/**\n * @publicApi\n */\nexport class IncomingRequestDeserializer implements ConsumerDeserializer {\n  deserialize(\n    value: any,\n    options?: Record<string, any>,\n  ): IncomingRequest | IncomingEvent {\n    return this.isExternal(value) ? this.mapToSchema(value, options) : value;\n  }\n\n  isExternal(value: any): boolean {\n    if (!value) {\n      return true;\n    }\n    if (\n      !isUndefined((value as IncomingRequest).pattern) ||\n      !isUndefined((value as IncomingRequest).data)\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  mapToSchema(\n    value: any,\n    options?: Record<string, any>,\n  ): IncomingRequest | IncomingEvent {\n    if (!options) {\n      return {\n        pattern: undefined,\n        data: undefined,\n      };\n    }\n    return {\n      pattern: options.channel,\n      data: value,\n    };\n  }\n}\n"]}