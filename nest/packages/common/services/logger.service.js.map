{"version":3,"file":"logger.service.js","sourceRoot":"/Users/hanxiaoxue/Documents/work/frontEndDebugger/nest/packages/common/","sources":["services/logger.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Optional } from '../decorators/core';\nimport { isObject } from '../utils/shared.utils';\nimport { ConsoleLogger } from './console-logger.service';\nimport { isLogLevelEnabled } from './utils';\n\n/**\n * @publicApi\n */\nexport type LogLevel = 'log' | 'error' | 'warn' | 'debug' | 'verbose';\n\n/**\n * @publicApi\n */\nexport interface LoggerService {\n  /**\n   * Write a 'log' level log.\n   */\n  log(message: any, ...optionalParams: any[]): any;\n\n  /**\n   * Write an 'error' level log.\n   */\n  error(message: any, ...optionalParams: any[]): any;\n\n  /**\n   * Write a 'warn' level log.\n   */\n  warn(message: any, ...optionalParams: any[]): any;\n\n  /**\n   * Write a 'debug' level log.\n   */\n  debug?(message: any, ...optionalParams: any[]): any;\n\n  /**\n   * Write a 'verbose' level log.\n   */\n  verbose?(message: any, ...optionalParams: any[]): any;\n\n  /**\n   * Set log levels.\n   * @param levels log levels\n   */\n  setLogLevels?(levels: LogLevel[]): any;\n}\n\ninterface LogBufferRecord {\n  /**\n   * Method to execute.\n   */\n  methodRef: Function;\n\n  /**\n   * Arguments to pass to the method.\n   */\n  arguments: unknown[];\n}\n\nconst DEFAULT_LOGGER = new ConsoleLogger();\n\nconst dateTimeFormatter = new Intl.DateTimeFormat(undefined, {\n  year: 'numeric',\n  hour: 'numeric',\n  minute: 'numeric',\n  second: 'numeric',\n  day: '2-digit',\n  month: '2-digit',\n});\n\n/**\n * @publicApi\n */\n@Injectable()\nexport class Logger implements LoggerService {\n  protected static logBuffer = new Array<LogBufferRecord>();\n  protected static staticInstanceRef?: LoggerService = DEFAULT_LOGGER;\n  protected static logLevels?: LogLevel[];\n  private static isBufferAttached: boolean;\n\n  protected localInstanceRef?: LoggerService;\n\n  private static WrapBuffer: MethodDecorator = (\n    target: object,\n    propertyKey: string | symbol,\n    descriptor: TypedPropertyDescriptor<any>,\n  ) => {\n    const originalFn = descriptor.value;\n    descriptor.value = function (...args: unknown[]) {\n      if (Logger.isBufferAttached) {\n        Logger.logBuffer.push({\n          methodRef: originalFn.bind(this),\n          arguments: args,\n        });\n        return;\n      }\n      return originalFn.call(this, ...args);\n    };\n  };\n\n  constructor();\n  constructor(context: string);\n  constructor(context: string, options?: { timestamp?: boolean });\n  constructor(\n    @Optional() protected context?: string,\n    @Optional() protected options: { timestamp?: boolean } = {},\n  ) {}\n\n  get localInstance(): LoggerService {\n    if (Logger.staticInstanceRef === DEFAULT_LOGGER) {\n      return this.registerLocalInstanceRef();\n    } else if (Logger.staticInstanceRef instanceof Logger) {\n      const prototype = Object.getPrototypeOf(Logger.staticInstanceRef);\n      if (prototype.constructor === Logger) {\n        return this.registerLocalInstanceRef();\n      }\n    }\n    return Logger.staticInstanceRef;\n  }\n\n  /**\n   * Write an 'error' level log.\n   */\n  error(message: any, stack?: string, context?: string): void;\n  error(message: any, ...optionalParams: [...any, string?, string?]): void;\n  @Logger.WrapBuffer\n  error(message: any, ...optionalParams: any[]) {\n    optionalParams = this.context\n      ? (optionalParams.length ? optionalParams : [undefined]).concat(\n          this.context,\n        )\n      : optionalParams;\n\n    this.localInstance?.error(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'log' level log.\n   */\n  log(message: any, context?: string): void;\n  log(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  log(message: any, ...optionalParams: any[]) {\n    optionalParams = this.context\n      ? optionalParams.concat(this.context)\n      : optionalParams;\n    this.localInstance?.log(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'warn' level log.\n   */\n  warn(message: any, context?: string): void;\n  warn(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  warn(message: any, ...optionalParams: any[]) {\n    optionalParams = this.context\n      ? optionalParams.concat(this.context)\n      : optionalParams;\n    this.localInstance?.warn(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'debug' level log.\n   */\n  debug(message: any, context?: string): void;\n  debug(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  debug(message: any, ...optionalParams: any[]) {\n    optionalParams = this.context\n      ? optionalParams.concat(this.context)\n      : optionalParams;\n    this.localInstance?.debug?.(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'verbose' level log.\n   */\n  verbose(message: any, context?: string): void;\n  verbose(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  verbose(message: any, ...optionalParams: any[]) {\n    optionalParams = this.context\n      ? optionalParams.concat(this.context)\n      : optionalParams;\n    this.localInstance?.verbose?.(message, ...optionalParams);\n  }\n\n  /**\n   * Write an 'error' level log.\n   */\n  static error(message: any, context?: string): void;\n  static error(message: any, stack?: string, context?: string): void;\n  static error(\n    message: any,\n    ...optionalParams: [...any, string?, string?]\n  ): void;\n  @Logger.WrapBuffer\n  static error(message: any, ...optionalParams: any[]) {\n    this.staticInstanceRef?.error(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'log' level log.\n   */\n  static log(message: any, context?: string): void;\n  static log(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  static log(message: any, ...optionalParams: any[]) {\n    this.staticInstanceRef?.log(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'warn' level log.\n   */\n  static warn(message: any, context?: string): void;\n  static warn(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  static warn(message: any, ...optionalParams: any[]) {\n    this.staticInstanceRef?.warn(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'debug' level log, if the configured level allows for it.\n   * Prints to `stdout` with newline.\n   */\n  static debug(message: any, context?: string): void;\n  static debug(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  static debug(message: any, ...optionalParams: any[]) {\n    this.staticInstanceRef?.debug?.(message, ...optionalParams);\n  }\n\n  /**\n   * Write a 'verbose' level log.\n   */\n  static verbose(message: any, context?: string): void;\n  static verbose(message: any, ...optionalParams: [...any, string?]): void;\n  @Logger.WrapBuffer\n  static verbose(message: any, ...optionalParams: any[]) {\n    this.staticInstanceRef?.verbose?.(message, ...optionalParams);\n  }\n\n  /**\n   * Print buffered logs and detach buffer.\n   */\n  static flush() {\n    this.isBufferAttached = false;\n    this.logBuffer.forEach(item =>\n      item.methodRef(...(item.arguments as [string])),\n    );\n    this.logBuffer = [];\n  }\n\n  /**\n   * Attach buffer.\n   * Turns on initialization logs buffering.\n   */\n  static attachBuffer() {\n    this.isBufferAttached = true;\n  }\n\n  /**\n   * Detach buffer.\n   * Turns off initialization logs buffering.\n   */\n  static detachBuffer() {\n    this.isBufferAttached = false;\n  }\n\n  static getTimestamp() {\n    return dateTimeFormatter.format(Date.now());\n  }\n\n  static overrideLogger(logger: LoggerService | LogLevel[] | boolean) {\n    if (Array.isArray(logger)) {\n      Logger.logLevels = logger;\n      return this.staticInstanceRef?.setLogLevels(logger);\n    }\n    if (isObject(logger)) {\n      if (logger instanceof Logger && logger.constructor !== Logger) {\n        const errorMessage = `Using the \"extends Logger\" instruction is not allowed in Nest v9. Please, use \"extends ConsoleLogger\" instead.`;\n        this.staticInstanceRef.error(errorMessage);\n        throw new Error(errorMessage);\n      }\n      this.staticInstanceRef = logger as LoggerService;\n    } else {\n      this.staticInstanceRef = undefined;\n    }\n  }\n\n  static isLevelEnabled(level: LogLevel): boolean {\n    const logLevels = Logger.logLevels;\n    return isLogLevelEnabled(level, logLevels);\n  }\n\n  private registerLocalInstanceRef() {\n    if (this.localInstanceRef) {\n      return this.localInstanceRef;\n    }\n    this.localInstanceRef = new ConsoleLogger(this.context, {\n      timestamp: this.options?.timestamp,\n      logLevels: Logger.logLevels,\n    });\n    return this.localInstanceRef;\n  }\n}\n"]}