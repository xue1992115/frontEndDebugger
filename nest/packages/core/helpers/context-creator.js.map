{"version":3,"file":"context-creator.js","sourceRoot":"/Users/hanxiaoxue/Documents/work/frontEndDebugger/nest/packages/core/","sources":["helpers/context-creator.ts"],"names":[],"mappings":";;;AACA,qDAAuD;AAGvD,MAAsB,cAAc;IAW3B,aAAa,CAClB,QAAoB,EACpB,QAAkC,EAClC,WAAmB,EACnB,SAAS,GAAG,0BAAc,EAC1B,UAAmB;QAEnB,MAAM,cAAc,GAClB,IAAI,CAAC,iBAAiB;YACtB,IAAI,CAAC,iBAAiB,CAAI,SAAS,EAAE,UAAU,CAAC,CAAC;QACnD,MAAM,aAAa,GAAG,IAAI,CAAC,oBAAoB,CAAI,QAAQ,EAAE,WAAW,CAAC,CAAC;QAC1E,MAAM,cAAc,GAAG,IAAI,CAAC,qBAAqB,CAAI,QAAQ,EAAE,WAAW,CAAC,CAAC;QAC5E,OAAO;YACL,GAAG,IAAI,CAAC,qBAAqB,CAC3B,cAAc,IAAK,EAAQ,EAC3B,SAAS,EACT,UAAU,CACX;YACD,GAAG,IAAI,CAAC,qBAAqB,CAAO,aAAa,EAAE,SAAS,EAAE,UAAU,CAAC;YACzE,GAAG,IAAI,CAAC,qBAAqB,CAC3B,cAAc,EACd,SAAS,EACT,UAAU,CACX;SACG,CAAC;IACT,CAAC;IAEM,oBAAoB,CAAI,QAAoB,EAAE,WAAmB;QACtE,MAAM,SAAS,GAAG,MAAM,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAClD,OAAO,OAAO,CAAC,WAAW,CAAC,WAAW,EAAE,SAAS,CAAC,WAAW,CAAC,CAAC;IACjE,CAAC;IAEM,qBAAqB,CAC1B,QAAyC,EACzC,WAAmB;QAEnB,OAAO,OAAO,CAAC,WAAW,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;IACpD,CAAC;IAES,YAAY,CACpB,SAAoB,EACpB,eAAgC;QAEhC,OAAO,SAAS,CAAC,SAAS;YACxB,CAAC,CAAC,SAAS,CAAC,SAAS,CAAC;gBAClB,KAAK,EAAE,eAAe,CAAC,KAAK;gBAC5B,aAAa,EAAE,eAAe,CAAC,uBAAuB,EAAE;aACzD,CAAC;YACJ,CAAC,CAAC,SAAS,CAAC;IAChB,CAAC;CACF;AA7DD,wCA6DC","sourcesContent":["import { Controller } from '@nestjs/common/interfaces';\nimport { STATIC_CONTEXT } from '../injector/constants';\nimport { ContextId, InstanceWrapper } from '../injector/instance-wrapper';\n\nexport abstract class ContextCreator {\n  public abstract createConcreteContext<T extends any[], R extends any[]>(\n    metadata: T,\n    contextId?: ContextId,\n    inquirerId?: string,\n  ): R;\n  public getGlobalMetadata?<T extends any[]>(\n    contextId?: ContextId,\n    inquirerId?: string,\n  ): T;\n\n  public createContext<T extends unknown[] = any, R extends unknown[] = any>(\n    instance: Controller,\n    callback: (...args: any[]) => void,\n    metadataKey: string,\n    contextId = STATIC_CONTEXT,\n    inquirerId?: string,\n  ): R {\n    const globalMetadata =\n      this.getGlobalMetadata &&\n      this.getGlobalMetadata<T>(contextId, inquirerId);\n    const classMetadata = this.reflectClassMetadata<T>(instance, metadataKey);\n    const methodMetadata = this.reflectMethodMetadata<T>(callback, metadataKey);\n    return [\n      ...this.createConcreteContext<T, R>(\n        globalMetadata || ([] as T),\n        contextId,\n        inquirerId,\n      ),\n      ...this.createConcreteContext<T, R>(classMetadata, contextId, inquirerId),\n      ...this.createConcreteContext<T, R>(\n        methodMetadata,\n        contextId,\n        inquirerId,\n      ),\n    ] as R;\n  }\n\n  public reflectClassMetadata<T>(instance: Controller, metadataKey: string): T {\n    const prototype = Object.getPrototypeOf(instance);\n    return Reflect.getMetadata(metadataKey, prototype.constructor);\n  }\n\n  public reflectMethodMetadata<T>(\n    callback: (...args: unknown[]) => unknown,\n    metadataKey: string,\n  ): T {\n    return Reflect.getMetadata(metadataKey, callback);\n  }\n\n  protected getContextId(\n    contextId: ContextId,\n    instanceWrapper: InstanceWrapper,\n  ): ContextId {\n    return contextId.getParent\n      ? contextId.getParent({\n          token: instanceWrapper.token,\n          isTreeDurable: instanceWrapper.isDependencyTreeDurable(),\n        })\n      : contextId;\n  }\n}\n"]}