{"version":3,"file":"resolver.js","sourceRoot":"/Users/hanxiaoxue/Documents/work/frontEndDebugger/nest/packages/core/","sources":["middleware/resolver.ts"],"names":[],"mappings":";;;AAKA,MAAa,kBAAkB;IAC7B,YACmB,mBAAwC,EACxC,QAAkB;QADlB,wBAAmB,GAAnB,mBAAmB,CAAqB;QACxC,aAAQ,GAAR,QAAQ,CAAU;IAClC,CAAC;IAEG,KAAK,CAAC,gBAAgB,CAAC,SAAiB,EAAE,UAAkB;QACjE,MAAM,aAAa,GACjB,IAAI,CAAC,mBAAmB,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC;QAC/D,MAAM,eAAe,GAAG,KAAK,EAAE,OAAwB,EAAE,EAAE,CACzD,IAAI,CAAC,yBAAyB,CAAC,OAAO,EAAE,aAAa,EAAE,SAAS,CAAC,CAAC;QACpE,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,aAAa,CAAC,MAAM,EAAE,CAAC,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC,CAAC;IACtE,CAAC;IAEO,KAAK,CAAC,yBAAyB,CACrC,OAAwB,EACxB,aAAkD,EAClD,SAAiB;QAEjB,MAAM,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,OAAO,EAAE,aAAa,EAAE,SAAS,CAAC,CAAC;IACxE,CAAC;CACF;AArBD,gDAqBC","sourcesContent":["import { Injector } from '../injector/injector';\nimport { InstanceWrapper } from '../injector/instance-wrapper';\nimport { InstanceToken, Module } from '../injector/module';\nimport { MiddlewareContainer } from './container';\n\nexport class MiddlewareResolver {\n  constructor(\n    private readonly middlewareContainer: MiddlewareContainer,\n    private readonly injector: Injector,\n  ) {}\n\n  public async resolveInstances(moduleRef: Module, moduleName: string) {\n    const middlewareMap =\n      this.middlewareContainer.getMiddlewareCollection(moduleName);\n    const resolveInstance = async (wrapper: InstanceWrapper) =>\n      this.resolveMiddlewareInstance(wrapper, middlewareMap, moduleRef);\n    await Promise.all([...middlewareMap.values()].map(resolveInstance));\n  }\n\n  private async resolveMiddlewareInstance(\n    wrapper: InstanceWrapper,\n    middlewareMap: Map<InstanceToken, InstanceWrapper>,\n    moduleRef: Module,\n  ) {\n    await this.injector.loadMiddleware(wrapper, middlewareMap, moduleRef);\n  }\n}\n"]}